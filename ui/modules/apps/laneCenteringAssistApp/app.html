<div class="bngApp lca-container" layout="column">
  <style>
    .lca-container {
      --lca-scale: clamp(0.75, calc(0.85 + (100vw - 720px) / 1600), 1.15);
      box-sizing: border-box;
      color: #f0f0f0;
      font-family: 'Roboto', sans-serif;
      display: grid;
      grid-template-columns: minmax(260px, 1fr) minmax(320px, 1.1fr);
      grid-template-rows: auto minmax(0, 1fr);
      grid-template-areas:
        "header visual"
        "info visual";
      height: 100%;
      min-width: 0;
      min-height: 0;
      gap: 12px;
      gap: calc(12px * var(--lca-scale));
      padding: 12px;
      padding: calc(12px * var(--lca-scale));
      font-size: clamp(12px, calc(12px + 0.2vw), 16px);
      line-height: 1.4;
    }

    .lca-header {
      grid-area: header;
      display: grid;
      grid-template-columns: minmax(150px, auto) 1fr;
      align-items: flex-start;
      gap: 12px;
      gap: calc(12px * var(--lca-scale));
    }

    .lca-status {
      padding: 6px 12px;
      padding: calc(6px * var(--lca-scale)) calc(12px * var(--lca-scale));
      border-radius: 6px;
      border-radius: calc(6px * var(--lca-scale));
      font-weight: 600;
      min-width: 120px;
      min-width: calc(120px * var(--lca-scale));
      text-align: center;
    }

    .lca-status-ready { background: rgba(60, 120, 255, 0.25); border-left: 4px solid #4ca3ff; }
    .lca-status-active { background: rgba(40, 180, 80, 0.35); border-left: 4px solid #39d66c; }
    .lca-status-idle { background: rgba(180, 180, 180, 0.2); border-left: 4px solid #d0d0d0; }
    .lca-status-warning { background: rgba(230, 150, 40, 0.35); border-left: 4px solid #ffb347; }
    .lca-status-missing { background: rgba(200, 60, 60, 0.35); border-left: 4px solid #ff6b6b; }

    .lca-status-detail {
      font-size: 0.85em;
      margin-top: 4px;
      margin-top: calc(4px * var(--lca-scale));
      opacity: 0.8;
    }

    .lca-header-metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      gap: calc(10px * var(--lca-scale));
      font-size: 0.9em;
      opacity: 0.9;
      text-align: left;
      align-content: start;
    }

    .lca-visual {
      grid-area: visual;
      position: relative;
      display: flex;
      align-items: stretch;
      justify-content: center;
      min-height: clamp(180px, calc(220px * var(--lca-scale)), 360px);
      min-width: 0;
    }

    .lca-visual canvas {
      display: block;
      width: 100%;
      height: auto;
      max-height: 100%;
      aspect-ratio: 4 / 3;
      border-radius: 8px;
      border-radius: calc(8px * var(--lca-scale));
      background: rgba(0, 0, 0, 0.35);
      box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.35);
      box-shadow: inset 0 0 calc(12px * var(--lca-scale)) rgba(0, 0, 0, 0.35);
    }

    .lca-info {
      grid-area: info;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 8px 16px;
      gap: calc(8px * var(--lca-scale)) calc(16px * var(--lca-scale));
      font-size: 0.9em;
      opacity: 0.92;
      min-height: 0;
      align-content: flex-start;
      overflow-y: auto;
    }

    .lca-warning {
      grid-column: 1 / -1;
      color: #ffb347;
      font-weight: 600;
    }

    @media (max-width: 960px) {
      .lca-container {
        grid-template-columns: minmax(240px, 1fr) minmax(280px, 1fr);
      }
    }

    @media (max-width: 720px) {
      .lca-container {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto minmax(0, 1fr);
        grid-template-areas:
          "header"
          "visual"
          "info";
      }

      .lca-header {
        grid-template-columns: 1fr;
      }

      .lca-info {
        overflow-y: visible;
      }

      .lca-visual {
        min-height: 220px;
      }
    }
  </style>
  <div class="lca-header">
    <div>
      <div class="lca-status" ng-class="vm.statusClass">{{vm.statusText}}</div>
      <div class="lca-status-detail" ng-if="vm.statusDetail">{{vm.statusDetail}}</div>
    </div>
    <div class="lca-header-metrics">
      <div>Assist: {{vm.assistForce}}</div>
      <div>Weight: {{vm.assistWeight}}</div>
      <div>Driver: {{vm.driverInput}}</div>
      <div>Final: {{vm.finalSteer}}</div>
    </div>
  </div>
  <div class="lca-visual">
    <canvas width="300" height="260"></canvas>
  </div>
  <div class="lca-info">
    <div>Speed: {{vm.speed}} m/s</div>
    <div>Lookahead: {{vm.lookahead}} m</div>
    <div>Target: {{vm.lookaheadTarget}} m</div>
    <div>Coverage: {{vm.pathCoverage}}</div>
    <div>Segments: {{vm.pathSegments}}</div>
    <div>Truncated: {{vm.pathTruncated}}</div>
    <div>Branches: {{vm.branchInfo}}</div>
    <div>Lane width: {{vm.laneWidth}} m</div>
    <div>Heading error: {{vm.headingError}} Â°</div>
    <div>Offset current: {{vm.offsetCurrent}} m</div>
    <div>Target offset: {{vm.offsetTarget}} m</div>
    <div>Offset error: {{vm.offsetError}} m</div>
    <div>Offset norm: {{vm.offsetNormalized}}</div>
    <div>Curvature: {{vm.curvature}}</div>
    <div>Samples: {{vm.pathPoints}}</div>
    <div>Curve radius: {{vm.curvatureRadius}} m</div>
    <div>Route length: {{vm.routeLength}} m</div>
    <div>Route nodes: {{vm.routeNodes}}</div>
    <div>Route span: {{vm.routeSpan}}</div>
    <div>Route data: {{vm.routeUpdated}}</div>
    <div>Warning: {{vm.warning ? 'YES' : 'No'}}</div>
    <div class="lca-warning" ng-if="vm.warning">Lane boundary proximity</div>
  </div>
</div>
